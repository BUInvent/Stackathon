language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '9.6' # highest available postgres version on Travis
dist: trusty # uses trusty environment
sudo: false # when on trusty, uses Docker containers for speed
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "supernatural-store-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)

before_deploy:
  - npm run build-client # make the bundle
  - rm -rf node_modules # omit from the tarball, since we skip cleanup
deploy:
  skip_cleanup: true # prevents travis from deleting the build
  provider: heroku
  app: supernatural-store2 # see README
  api_key:
    secure: "np2E4ZdROMOkkbDCtoD54Rfx1jKMHwXImtksOMBvyW4tQY8sg7sIeB9pFaHMNtDzkUx34B9n1gkAsp/NTxeysDdwNKNBX/zRxSvmP0uMqORpcOsw9PkRAqGPqeVZ0CdMRx2Fzxej79TnpYLA8Uwkh4PpkCqc98cfgER2tNc2cWGnoxshBNEiCwzKDCeuegaqUAIBbu+cION3iOPVej6405wrvo5MaSOX/k+CH8HJsEVdBHvcSrjR5niltGOaRkxBx8hJettG+oIOh3zW/ZfxV9b6NyQvejOkLV4K1YiFMYev98Pr0DbqiPW0toAyJSO7F5aWh79zzLGkv7oPMheeCNI5e8XBol0MIiGaNYYMKpiygN9ZF5Q4R59/hVe70OcFbYScKjYZhwckb1Ou/YNH4gVqUIsW8kY9YEI2REQarCqQuPZjXYyh9+W4oG7kILU1npZ2XXpA+pKhi9WJamaRtUGHTodwQRLvVLISs1JhpNaeHDkNRDJQtPGPkCcqtPkjemcp76SWAXNQye6RLxGpW36MKEKlDndstI6T3OqlX3SmhSMGHUyvMOkq5f1JYua5nHqI+eYcUIHrmKxzQVqC7+2QzcfOT1WMBZ0pU1GVbpUbz8A5clBXx3WbI1P3pf+GX5ei+ofyxwS9BBPseLrPm1wmKgr6B2HnRUteDMyAMZM="